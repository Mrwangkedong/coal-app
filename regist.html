<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>Hello MUI</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<link rel="stylesheet" href="css/layui.css" />
	</head>

	<style>
		.layui-form-label {
			width: 90px;
		}

		.layui-input {
			width: 210px;
		}
	</style>

	<body style="padding-top: 26px;">



		<label>
			<a href="login.html"><button class="layui-btn layui-btn-sm">返回登录页面</button></a>
			<h1 align="center">货车司机在线注册</h1>
		</label>

		<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
			<legend>基本信息填写</legend>
		</fieldset>



		<form class="layui-form" lay-filter="newDriverInfo">

			<div class="layui-form-item">
				<label class="layui-form-label">输入姓名</label>
				<div class="layui-input-inline">
					<input type="text" name="d_name" autocomplete="off" placeholder="请输入姓名" class="layui-input">
				</div>
			</div>

			<div class="layui-form-item">
				<label class="layui-form-label">性别</label>
				<div class="layui-input-inline">
					<input type="radio" name="d_sex" value="男" title="男" checked="">
					<input type="radio" name="d_sex" value="女" title="女">
				</div>
			</div>

			<div class="layui-form-item">
				<label class="layui-form-label">手机号</label>
				<div class="layui-input-block">
					<input type="text" name="d_phonenum" autocomplete="off" placeholder="请输入手机号" class="layui-input"
						lay-verify="phone">
				</div>
			</div>

			<div class="layui-form-item">
				<label class="layui-form-label">登录密码</label>
				<div class="layui-input-block">
					<input type="text" name="d_password" autocomplete="off" placeholder="请输入登录密码" required
						class="layui-input">
				</div>
			</div>

			<div class="layui-form-item">
				<label class="layui-form-label">支付密码</label>
				<div class="layui-input-block">
					<input type="text" name="d_pay_password" autocomplete="off" placeholder="请输入登录支付密码(6位数字)"
						class="layui-input">
				</div>
			</div>


			<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
				<legend>身份资质信息填写</legend>
			</fieldset>

			<div class="layui-form-item">
				<label class="layui-form-label">身份证号码</label>
				<div class="layui-input-inline">
					<input type="text" name="pcard_number" autocomplete="off" placeholder="请输入身份证号码"
						class="layui-input">
				</div>
			</div>


			<div class="layui-form-item">
				<label class="layui-form-label">出生日期</label>
				<div class="layui-input-inline">
					<input type="text" class="layui-input" name="birthdate" id="birthDay" placeholder="yyyy-MM-dd">
				</div>
			</div>

			<div class="layui-form-item">
				<label class="layui-form-label">驾照开始日期</label>
				<div class="layui-input-inline">
					<input type="text" class="layui-input" name="dcard_startDate" id="dcard_validfrom"
						placeholder="yyyy-MM-dd">
				</div>
			</div>

			<div class="layui-form-item">
				<label class="layui-form-label">驾照年限</label>
				<div class="layui-input-inline">
					<input type="number" class="layui-input" name="dcard_validfor" id="dcard_validfor"
						placeholder="请输入驾照年限">
				</div>
			</div>

			<div class="layui-form-item">
				<label class="layui-form-label">车牌号码</label>
				<div class="layui-input-inline">
					<input type="text" class="layui-input" name="dcard_carnumber" id="dcard_carnumber"
						placeholder="请输入车牌号码">
				</div>
			</div>

			<div class="layui-form-item">
				<label class="layui-form-label">车辆类型</label>
				<div class="layui-input-inline">
					<input type="radio" name="dcard_carclass" value="1" title="半挂" checked="">
					<input type="radio" name="dcard_carclass" value="2" title="前四后八">
				</div>
			</div>

			<div id="driverImgs">
				<div class="layui-form-item">
					<label class="layui-form-label">身份证（正）</label>
					<div class="layui-input-inline">
						<input type="file" class="layui-input" name="driverImg" id="pcard_photoaddress1"
							placeholder="上传身份证照片(正)">
					</div>

					<div class="layui-form-item">
						<label class="layui-form-label">身份证（反）</label>
						<div class="layui-input-inline">
							<input type="file" class="layui-input" name="driverImg" id="pcard_photoaddress2">
						</div>
					</div>

					<div class="layui-form-item">
						<label class="layui-form-label">驾驶证</label>
						<div class="layui-input-inline">
							<input type="file" class="layui-input" name="driverImg" id="dcard_photo">
						</div>
					</div>

					<div class="layui-form-item">
						<label class="layui-form-label">车辆照片</label>
						<div class="layui-input-inline">
							<input type="file" class="layui-input" name="driverImg" id="dcard_carphoto">
						</div>
					</div>

				</div>
			</div>

			<div class="layui-form-item" align="center">
				<button type="reset" class="layui-btn layui-btn-warm" id="reset">重置</button>
				<button type="button" class="layui-btn" id="submit">提交申请</button>
			</div>
		</form>



	</body>

</html>
<script src="js/mui.min.js" type="text/javascript" charset="utf-8"></script>
<script src="js/jquery-3.4.1.min.js"></script>
<script src="js/layui.js"></script>
<script>
	layui.use('form', function() {
		var form = layui.form;

		//表单取值
		layui.$('#submit').on('click', function() {
			var data = form.val('newDriverInfo');
			console.log(data)
			//1、从零开始创建FormData对象 手动注入
			var formData = jsToFormData(data); //将json转化为FormData()
			//检查是否有空值
			for (let item of formData) {
				if (item["1"] === "") {
					alert("表单值不能有空")
					return;
				}
			}

			//注入 name=file
			var files = $("#driverImgs input[type='file']");
			for (var i = 0; i < files.length; i++) {
				//注意：这里append进去的是File对象，而不是FileList对象
				formData.append("driverImg", files[i].files[0]);
			}


			//调用ajax进行添加
			$.ajax({
				url: "http://192.168.43.30:8081/addNewDriver",
				type: 'post',
				data: formData,
				processData: false,
				contentType: false,
				beforeSend: function() {

				},
				success: function(data) {
					console.log(data);
					if (data.code === 1) {
						alert("申请成功，请等待审批");
					} else if (data.code === 0) {
						alert("申请失败");
					} else {
						alert(data.content);
					}
				},
				error: function(error) {
					alert("申请失败，请注意信息完整性/文件大小，文件总大小小于1M");
				}
			});
			// //ajax

		});

	});



	//对象转formdata格式
	function jsToFormData(config) {
		const formData = new FormData();
		//循环传入的值转换formData
		Object.keys(config).forEach((key) => {
			formData.append(key, config[key]);
		});
		return formData;
	}
</script>
